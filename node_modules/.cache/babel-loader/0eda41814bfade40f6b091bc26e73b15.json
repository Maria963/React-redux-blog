{"ast":null,"code":"import _defineProperty from \"/home/cretrix/projects/React-redux-blog/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport axios from \"axios\";\nimport { API } from \"../actions/types\";\nimport { accessDenied, apiError, apiStart, apiEnd } from \"../actions/api\";\n\nvar apiMiddleware = function apiMiddleware(_ref) {\n  var dispatch = _ref.dispatch;\n  return function (next) {\n    return function (action) {\n      next(action);\n      console.log(action.type);\n      if (action.type !== API) return;\n      var _action$payload = action.payload,\n          url = _action$payload.url,\n          method = _action$payload.method,\n          data = _action$payload.data,\n          accessToken = _action$payload.accessToken,\n          onSuccess = _action$payload.onSuccess,\n          onFailure = _action$payload.onFailure,\n          label = _action$payload.label,\n          headers = _action$payload.headers;\n      var dataOrParams = [\"GET\", \"DELETE\"].includes(method) ? \"params\" : \"data\"; // axios default configs\n\n      axios.defaults.baseURL = process.env.REACT_APP_BASE_URL || \"\";\n      axios.defaults.headers.common[\"Content-Type\"] = \"application/json\";\n      axios.defaults.headers.common[\"Authorization\"] = \"Bearer \".concat(accessToken);\n\n      if (label) {\n        dispatch(apiStart(label));\n      }\n\n      axios.request(_defineProperty({\n        url: url,\n        method: method,\n        headers: headers\n      }, dataOrParams, data)).then(function (_ref2) {\n        var data = _ref2.data;\n        dispatch(onSuccess(data));\n      }).catch(function (error) {\n        dispatch(apiError(error));\n        dispatch(onFailure(error));\n\n        if (error.response && error.response.status === 403) {\n          dispatch(accessDenied(window.location.pathname));\n        }\n      }).finally(function () {\n        if (label) {\n          dispatch(apiEnd(label));\n        }\n      });\n    };\n  };\n};\n\nexport default apiMiddleware;","map":{"version":3,"sources":["/home/cretrix/projects/React-redux-blog/src/middleware/api.js"],"names":["axios","API","accessDenied","apiError","apiStart","apiEnd","apiMiddleware","dispatch","next","action","console","log","type","payload","url","method","data","accessToken","onSuccess","onFailure","label","headers","dataOrParams","includes","defaults","baseURL","process","env","REACT_APP_BASE_URL","common","request","then","catch","error","response","status","window","location","pathname","finally"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,GAAT,QAAoB,kBAApB;AACA,SAASC,YAAT,EAAuBC,QAAvB,EAAiCC,QAAjC,EAA2CC,MAA3C,QAAyD,gBAAzD;;AAEA,IAAMC,aAAa,GAAG,SAAhBA,aAAgB;AAAA,MAAGC,QAAH,QAAGA,QAAH;AAAA,SAAkB,UAAAC,IAAI;AAAA,WAAI,UAAAC,MAAM,EAAI;AACxDD,MAAAA,IAAI,CAACC,MAAD,CAAJ;AACAC,MAAAA,OAAO,CAACC,GAAR,CAAYF,MAAM,CAACG,IAAnB;AACA,UAAIH,MAAM,CAACG,IAAP,KAAgBX,GAApB,EAAyB;AAH+B,4BAcpDQ,MAAM,CAACI,OAd6C;AAAA,UAMtDC,GANsD,mBAMtDA,GANsD;AAAA,UAOtDC,MAPsD,mBAOtDA,MAPsD;AAAA,UAQtDC,IARsD,mBAQtDA,IARsD;AAAA,UAStDC,WATsD,mBAStDA,WATsD;AAAA,UAUtDC,SAVsD,mBAUtDA,SAVsD;AAAA,UAWtDC,SAXsD,mBAWtDA,SAXsD;AAAA,UAYtDC,KAZsD,mBAYtDA,KAZsD;AAAA,UAatDC,OAbsD,mBAatDA,OAbsD;AAexD,UAAMC,YAAY,GAAG,CAAC,KAAD,EAAQ,QAAR,EAAkBC,QAAlB,CAA2BR,MAA3B,IAAqC,QAArC,GAAgD,MAArE,CAfwD,CAiBxD;;AACAf,MAAAA,KAAK,CAACwB,QAAN,CAAeC,OAAf,GAAyBC,OAAO,CAACC,GAAR,CAAYC,kBAAZ,IAAkC,EAA3D;AACA5B,MAAAA,KAAK,CAACwB,QAAN,CAAeH,OAAf,CAAuBQ,MAAvB,CAA8B,cAA9B,IAAgD,kBAAhD;AACA7B,MAAAA,KAAK,CAACwB,QAAN,CAAeH,OAAf,CAAuBQ,MAAvB,CAA8B,eAA9B,qBAA2DZ,WAA3D;;AAEA,UAAIG,KAAJ,EAAW;AACTb,QAAAA,QAAQ,CAACH,QAAQ,CAACgB,KAAD,CAAT,CAAR;AACD;;AAEDpB,MAAAA,KAAK,CACF8B,OADH;AAEIhB,QAAAA,GAAG,EAAHA,GAFJ;AAGIC,QAAAA,MAAM,EAANA,MAHJ;AAIIM,QAAAA,OAAO,EAAPA;AAJJ,SAKKC,YALL,EAKoBN,IALpB,GAOGe,IAPH,CAOQ,iBAAc;AAAA,YAAXf,IAAW,SAAXA,IAAW;AAClBT,QAAAA,QAAQ,CAACW,SAAS,CAACF,IAAD,CAAV,CAAR;AACD,OATH,EAUGgB,KAVH,CAUS,UAAAC,KAAK,EAAI;AACd1B,QAAAA,QAAQ,CAACJ,QAAQ,CAAC8B,KAAD,CAAT,CAAR;AACA1B,QAAAA,QAAQ,CAACY,SAAS,CAACc,KAAD,CAAV,CAAR;;AAEA,YAAIA,KAAK,CAACC,QAAN,IAAkBD,KAAK,CAACC,QAAN,CAAeC,MAAf,KAA0B,GAAhD,EAAqD;AACnD5B,UAAAA,QAAQ,CAACL,YAAY,CAACkC,MAAM,CAACC,QAAP,CAAgBC,QAAjB,CAAb,CAAR;AACD;AACF,OAjBH,EAkBGC,OAlBH,CAkBW,YAAM;AACb,YAAInB,KAAJ,EAAW;AACTb,UAAAA,QAAQ,CAACF,MAAM,CAACe,KAAD,CAAP,CAAR;AACD;AACF,OAtBH;AAuBD,KAjD2C;AAAA,GAAtB;AAAA,CAAtB;;AAmDA,eAAed,aAAf","sourcesContent":["import axios from \"axios\";\nimport { API } from \"../actions/types\";\nimport { accessDenied, apiError, apiStart, apiEnd } from \"../actions/api\";\n\nconst apiMiddleware = ({ dispatch }) => next => action => {\n  next(action);\n  console.log(action.type);\n  if (action.type !== API) return;\n\n  const {\n    url,\n    method,\n    data,\n    accessToken,\n    onSuccess,\n    onFailure,\n    label,\n    headers\n  } = action.payload;\n  const dataOrParams = [\"GET\", \"DELETE\"].includes(method) ? \"params\" : \"data\";\n\n  // axios default configs\n  axios.defaults.baseURL = process.env.REACT_APP_BASE_URL || \"\";\n  axios.defaults.headers.common[\"Content-Type\"] = \"application/json\";\n  axios.defaults.headers.common[\"Authorization\"] = `Bearer ${accessToken}`;\n\n  if (label) {\n    dispatch(apiStart(label));\n  }\n\n  axios\n    .request({\n      url,\n      method,\n      headers,\n      [dataOrParams]: data\n    })\n    .then(({ data }) => {\n      dispatch(onSuccess(data));\n    })\n    .catch(error => {\n      dispatch(apiError(error));\n      dispatch(onFailure(error));\n\n      if (error.response && error.response.status === 403) {\n        dispatch(accessDenied(window.location.pathname));\n      }\n    })\n    .finally(() => {\n      if (label) {\n        dispatch(apiEnd(label));\n      }\n    });\n};\n\nexport default apiMiddleware;\n"]},"metadata":{},"sourceType":"module"}